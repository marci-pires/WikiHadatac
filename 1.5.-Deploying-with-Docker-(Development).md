# Introduction

If you are developing HADatAc, you can also use Docker to build and run it. To build the container, you just need to include the `docker-compose.dev.yml` file in your commands as well. This file simply includes a Docker Volume that mounts the local `app` directory to the `app` directory inside of the Docker container. This way, whenever you edit any files inside of that directory, they will automatically be changed inside of the Docker container as well.

HADatAc is already configured to reload changed files, so to see changes you make, you simply have to refresh the page you are viewing. Any changes you made to files in the `app` directory will automatically be used.

To get started, you should install Docker, Git and then clone the HADatAc repository to your local machine.

# Step 1: Configuring HADatAc

The various HADatAc configuration files need to be changed before you build it with Docker. After you build the hadatac service, though, you can edit the configuration files inside of the container and restart the service.

The following configuration files in particular, need to be changed to suit your needs:

* `conf/hadatac-docker.conf` - The base_url should be changed to the domain name where HADatAc is being deployed. Also, the community settings (at the bottom of the file) should be adjusted to your needs. Particularly, the ont_prefix setting should be properly set.
* `conf/autoccsv-docker.config` - The template_file_name setting should be set to the template file you plan to use for CSV header mapping.
* `conf/play-authenticate/smtp.conf` - The SMTP setting should be set properly to allow for sending registration emails.

Read [this section](https://github.com/paulopinheiro1234/hadatac/wiki/2.1.-Software-Configuration) for more information about the configuration files.

# Step 2: Building the Development Docker Container

To build HADatAc for the purposes of development, you would run the following command.

```bash
docker-compose -f docker-compose.yml -f docker-compose.dev.yml build
```

This will build the three services defined in the `docker-compose.yml` file, namely the hadatac, solr and blazegraph services. To learn how to start and stop them, read the following section.

# Step 3: Starting and Stopping the Docker Containers

To start the hadatac service...

```bash
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up hadatac
```

This will start the HADatAc Docker container and attach to the terminal output of the hadatac service. It will automatically start the blazegraph and solr containers as well.

To stop the hadatac service...

```bash
docker-compose -f docker-compose.yml -f docker-compose.dev.yml stop
```

This will stop the hadatac, solr and blazegraph services. You can bring them back up with the `up` command above.

# Other Information

## Tearing Down the Containers

To remove the containers, you would run the following command.

```bash
docker-compose -f docker-compose.yml -f docker-compose.dev.yml down
```

This will destroy the containers, but maintains the Docker Volumes that contain the Blazegraph and Solr data, and also the HADatAc `conf` directory and the `csvs` directory that contains the ingested CSV files.

If you wish to completely blow away the container, the volumes and any sub-containers used in building it, you would run the following command.

```bash
docker-compose -f docker-compose.yml -f docker-compose.dev.yml down -v --remove-orphans
```

The next time you run the `up` command, a blank HADatAc instance will be created and started.

## Useful Commands

I find it useful to create a Bash alias for the long development Docker Compose command.

```bash
alias comp_dev='docker-compose -f docker-compose.yml -f docker-compose.dev.yml'
```

Then, the commands for building, starting and stopping the containers becomes `comp_dev build`, `comp_dev start` and `comp_dev stop`, respectively.